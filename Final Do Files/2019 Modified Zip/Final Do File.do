*Final Do-File - Simplified

*2013 HH + INDVDL data merged
use "\\Client\H$\Econ451\Malawi\Malawi Data\2013hh_individual (merged).dta", clear

drop _merge
merge 1:1 PID using "\\Client\H$\Econ451\Malawi\Malawi Data\IHPS2016MemberDatabase_16.dta"

drop if eligible_tracking != 1
*deletes code (3) in status
drop if status == 5

*drought treat
gen drtreat = 1 if district ==  206
replace drtreat = 1 if district ==  208
replace drtreat = 1 if district ==  201
replace drtreat = 1 if district ==  204
*not including Ntcheu (209) bc flood need= 12
*not including Nkhotak (202) bc drought need= 13 

*control
replace drtreat = 0 if district ==  101
replace drtreat = 0 if district ==  103
replace drtreat = 0 if district ==  306
replace drtreat = 0 if district ==  207
replace drtreat = 0 if district ==  105
*not including Karonga (102) bc affected by flood
*not including Ntchisi (203) bc drought need = 16
*_____________________________________________________


*drop all districts not used in treat or control 

****RURAL****
*Karonga
drop if district == 102
*Nkhotakota
drop if district == 202
*Ntchisi
drop if district == 203
*Salima
drop if district == 205
*Ntcheu
drop if district == 209
*Mangochi
drop if district == 301
*Machinga
drop if district == 302
*Zomba
drop if district == 303
*Chiradzulu
drop if district == 304
*Blantyre
drop if district == 305
*Thyolo
drop if district == 307
*Mulanje
drop if district == 308
*Phalombe
drop if district == 309
*Chikwawa
drop if district == 310
*Nsanje
drop if district == 311
*Balaka
drop if district == 312


***URBAN***
*Mzuzu City 
drop if district == 107

*Zomba City
drop if district == 314

*Blantyre City 
drop if district == 315

*Lilongwe City
drop if district == 210

*_____________________________________________________


*************** TABLE 1 (Diff in Means) ***************
 
*************  ag worker for past year
ttest ag, by(drtreat)

*************  educated 
ttest  educated, by(drtreat)

*************  male*
ttest male, by(drtreat)

*************   married (3,800 mi)
ttest  married, by(drtreat)

*************  hh size**
ttest hhsize2013, by(drtreat)

*************  age 
ttest age2013, by(drtreat)

************* young adult dummy (age 18 - 28 in 2016)
ttest youngadult, by(drtreat)

************* chronic illness dummy***
ttest chronic_ill, by(drtreat)

************* salary worker dummy  
ttest salaryworker, by(drtreat)

************* hrs spent collecting water 
ttest hrs_water, by(drtreat)

*****************************************************

*Merge 2016 indvdl data (hh_mod_b_13 = master), (hh_mod_b_16 = user)
drop _merge

rename hh_b10a hh_b10a_new
rename hh_b15a hh_b15a_new
merge 1:1 PID using "\\Client\C$\Users\carabraasch\Econ451\Malawi\Malawi Data\2016hh_individual (merged).dta"

*if _merge==1, person is there in 2013 but not 2016 
*if _merge==2, person is there in 2016 but not 2013
*if _merge==3, person is there in 2013 AND 2016

gen gone2016 =1 if _merge==1
replace gone2016 =0 if _merge==3
drop if _merge == 2

gen tracked=1 if district!=district2016 & district2016!=.
replace gone2016 = 1 if tracked==1
tab gone 

--
******************** REGRESSIONS ********************* 
reg gone2016 drtreat

*all controls (table 2):
reg gone2016 drtreat ag educated chronic_ill youngadult hhsize2013 married salaryworker hrs_water male age2013

*interesting findings: 
reg gone2016 drtreat educated ag 

*with controls:
reg gone drtreat educated ag youngadult

reg gone drtreat ag salaryworker 

--
*************** TABLE 2 ***************

sysdir set PLUS \\Client\c$\Users\carabraasch\ado
ssc instal outreg2

** Column 1 
reg gone2016 drtreat if ag !=. & educated !=. & male !=. & married !=. & hhsize2013 !=. & age2013 !=. & youngadult !=. & chronic_ill !=. & salaryworker !=. & hrs_water !=.
outreg2 using "\\Client\C$\Users\carabraasch\Econ451\Malawi\Jan_table2.xls", replace 

** Column 2
reg gone2016 drtreat ag educated male married hhsize2013 age2013 youngadult chronic_ill salaryworker hrs_water
outreg2 using "\\Client\C$\Users\carabraasch\Econ451\Malawi\Jan_table2.xls", append

*************** TABLE 3 ***************

** Column 1 
reg gone2016 drtreat ag drtreat_ag if ag !=. & educated !=. & male !=. & married !=. & hhsize2013 !=. & age2013 !=. & youngadult !=. & chronic_ill !=. & salaryworker !=. & hrs_water !=. & drtreat_ag !=.
outreg2 using "\\Client\C$\Users\carabraasch\Econ451\Malawi\Jan_table3.xls", replace 

** Column 2
reg gone2016 drtreat ag drtreat_ag educated male married hhsize2013 age2013 youngadult chronic_ill salaryworker hrs_water 
outreg2 using "\\Client\C$\Users\carabraasch\Econ451\Malawi\Jan_table3.xls", append


--
*DIFF in DIFF (ag)
gen drtreat_ag = 1 if drtreat*ag == 1
replace drtreat_ag = 0 if drtreat*ag == 0
reg gone drtreat ag drtreat_ag

*indvdls in drtreat NOT in ag are 19.9 pps less likely to migrate than those in control group
*indvdls in ag in cntrl group are 27.48 pps less likely to migrate than those in control group
*among indvdls in drtreat, those in ag are 14.15 pps 
*  MORE likely to migrate than those who are not

--
*DIFF in DIFF (under 25 yrs old)
gen drtreat_under25 = 1 if drtreat*under25 == 1
replace drtreat_under25 = 0 if drtreat*under25 == 0
reg gone drtreat under25 drtreat_under25


--
*DIFF in DIFF (young adult)
gen drtreat_youngadult = 1 if drtreat*youngadult == 1
replace drtreat_youngadult = 0 if drtreat*youngadult == 0
reg gone drtreat youngadult drtreat_youngadult


--
*DIFF in DIFF (educated)
gen drtreat_ed = 1 if drtreat*ed == 1
replace drtreat_ed = 0 if drtreat*ed == 0
reg gone drtreat ed drtreat_ed


--
*DIFF in DIFF (male)
gen drtreat_male = 1 if drtreat*male == 1
replace drtreat_male = 0 if drtreat*male == 0
reg gone drtreat male drtreat_male


--
*DIFF in DIFF (hrs water)
gen drtreat_hrs_water = 1 if drtreat*hrs_water == 1
replace drtreat_hrs_water = 0 if drtreat*hrs_water == 0
reg gone drtreat hrs_water drtreat_hrs_water


---

*impute missing values to mean 

*married
sum married if drtreat ==.
gen married_mi = 1 if married ==.
replace married_mi = 0 if married !=.
replace married = 0.5042894 if married ==.


*regression with these: 

*reg y t x1 x2 x3 ... x1_mi x2_mi ... 
reg gone2016 drtreat ag educated chronic_ill hhsize2013 married sicklately salaryworker hrs_water male age under25 christian married_mi christian_mi 


--

tab y2_hhid drtreat
*2,186 individuals

by y2_hhid, sort: gen nvals = _n == 1
tab nvals
count if nvals ==1 & drtreat == 1 | nvals == 1 & drtreat == 0
*577 households 

